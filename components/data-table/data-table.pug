include ./controls.pug 

//- tableview partials 
+partial('renderMarkup').
    {{#if typeof . === 'string'}}
        {{> { template: . } }}
    {{else}}
        {{{ . }}}
    {{/if}}


//- Header part
+iff('firstRunDone')
    +iff('mode === "add-new"')
        +if('addingNew')
            +apply('editForm') 
    +else
        r-table(class!="        \
            {{#if openedRow}}   \
                                \
            {{else}}            \
                selectable      \
            {{/if}}             \
            ")
            r-head
                
                +if('@.partials.header')
                    r-row
                        th(colspan="{{ colNames.length }}")
                            +apply('header')
                +if('selectedFilter !== "all"')
                    r-row
                        th(colspan="{{ colNames.length }}")
                            .ui.attached.warning.message.segment
                                .header 
                                    i.warning.icon 
                                    | Filtered Content 
                                p.
                                    You are seeing a filtered content. 
                                    #[btn.blue.mini(on-buttonclick="setFilter" value="all") #[i.remove.icon] Clear Filter]

                +if('addingNew')
                    r-row(class="active")
                        th(colspan="{{ colNames.length }}")
                            .data-table-opened-row(slide-in="true")
                                +apply('editForm')

                r-row                    
                    +each('colNames')
                        r-head-col 
                            +apply('renderMarkup')

            //- -----------------------------------------------
            //- body of table 
            //- -----------------------------------------------
            r-body
                +each('tableview_visible:i')
                    tr(
                        data-anchor="{{.id}}"
                        on-click!="['clicked', this]"
                        class!="                            \
                            {{#if isDisabled(.id)}}         \
                                disabled                    \
                            {{else}}                        \
                                {{#if ! isEditingRow(.id) && ! isViewingRow(.id)}} \
                                    data-table-clickable-row    \
                                {{/if}}                     \
                            {{/if}}                         \
                            "
                        )    
                        //- -----------------------------------------------
                        //- edit form
                        //- -----------------------------------------------
                        +iff('isEditingRow(.id)')
                            td(colspan="{{ colNames.length }}")
                                .data-table-opened-row
                                    +apply('editForm')

                        //- -----------------------------------------------
                        //- view form
                        //- -----------------------------------------------
                        +elif('isViewingRow(.id)')
                            td(colspan="{{ colNames.length }}")    
                                .data-table-opened-row
                                    +apply('viewForm')
                            
                        //- -----------------------------------------------
                        //- normal rows 
                        //- -----------------------------------------------
                        +else
                            +each(".cols:colindex")
                                td(data-th="{{colNames[colindex]}}")
                                    +iff('colindex === 0 && isLastClicked(tableview_visible[i].id)')
                                        +iff('isOpeningNow(tableview_visible[i].id)')
                                            //- if row is opening, mark first column with teal ribbon label 
                                            .ui.teal.ribbon.label
                                                +apply('renderMarkup')
                                        +else
                                            //- if row is opening, mark first column with orange ribbon label 
                                            .ui.orange.ribbon.label
                                                +apply('renderMarkup')
                                        +endif
                                    +else
                                        +apply('renderMarkup')
                                    +endif
                        +endif
            r-foot
                tr
                    th(colspan="{{ colNames.length }}")
                        include ./pagination.pug
                +if('@.partials.footer')
                    r-row
                        th(colspan="{{ colNames.length }}")
                            +apply('footer')

    +endif
+else
    include ./first-loading.pug
+endif

include ./open-row-dimmer.pug
