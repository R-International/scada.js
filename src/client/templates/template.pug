include mixins.pug
doctype html
html(lang="en-GB")
    head
        meta(charset="utf-8")
        meta(
            name="viewport"
            content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"
            )
        meta(http-equiv='cache-control' content='no-cache')
        meta(http-equiv='expires' content='0')
        meta(http-equiv='pragma' content='no-cache')
        meta(name="mobile-web-app-capable" content="yes")
        link(rel="icon" href="favicon.ico")
        link(rel="icon" sizes="192x192" href="favicon.ico")
        block title
            title ScadaJS #{app}
        block head
        script if (typeof module === 'object') {window.module = module; module = undefined;}
        script(src="js/vendor.js")
        script if (window.module) module = window.module;
        link(rel="stylesheet", href="css/vendor.css")
    body(ontouchstart)
        block content
            #main-output 
                .ui.centered.grid
                    .row
                        .column(style="padding-top: 10%")
                            img.ui.small.centered.image(src="scadajs-text.png")

                .ui.active.big.text.loader#main-output
                    p Loading Application... (%#[b#percent])
                    
                    .ui.progress.red(id="percentProgress")
                        .bar(style="min-width: 0 !important;")


        block script
            //- script(src='app.js')
        script.
            
            $.ajax({
              url: 'app.js',
              type: 'GET',
              success: function(data) {
                console.log("page loaded");
              }, 
              error: function(e) {
                  console.error("something went wrong while loading page: ", e); 
                  alert("something went wrong while loading page: ", e); 
              },
                xhr: function()
                  {
                    $('#percentProgress').progress({showActivity: false});
            
                    var xhr = new window.XMLHttpRequest();
                    //Upload progress
                    xhr.upload.addEventListener("progress", function(evt){
                      if (evt.lengthComputable) {
                        var percentComplete = evt.loaded / evt.total;
                        //Do something with upload progress
                        console.log(percentComplete);
                      }
                    }, false);
                    //Download progress
                    xhr.addEventListener("progress", function(evt){
                      if (evt.lengthComputable) {
                        var percentComplete = evt.loaded / evt.total;
                        //Do something with download progress
                        console.log(percentComplete);
                        percentInt = parseInt(percentComplete * 100)
                        $('#percent').text(percentInt);
                        $('#percentProgress').progress("set progress", percentInt); 

                      }
                    }, false);
                    return xhr;
                  }
            });
